# seed.py
from database import SessionLocal, engine, Base
import models
from datetime import datetime, timezone
from sqlalchemy.exc import IntegrityError


# Pega aquí tu lista completa NEW_ITEMS (idéntica a la que ya tenías)
NEW_ITEMS = [ {"sap":"40600244","breve_descripcion":"TX.DIG.P/GS7000 SEG.1:1 #4042873","descripcion":"Transmisor digital de reversa para GS7000 segmentación 1:1, EDR GS1185, Ordering: 4042873. - Marca: Cisco, P/N: 800-4042188-01","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600245","breve_descripcion":"TX.DIG.P/GS7000 SEG.2:1 #4042877","descripcion":"Transmisor digital de reversa para GS7000 segmentación 2:1, EDR GS2185, Ordering: 4042877. - Marca: Cisco, P/N: 800-4042904-01","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600255","breve_descripcion":"MODUL.RX.1GHZ HARMONIC #NRM 3111A-AS-2L","descripcion":"Módulo receptor óptico 1 Ghz para nodo escalable PWRBlazer con conector SC/APC (incluye protector metálico de pigtail). - Marca: Harmonic, P/N: NRM3111A-AS-2L","marca":"HARMONIC/ AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600244","breve_descripcion":"TX.DIG.P/GS7000 SEG.1:1 #4042873","descripcion":"Transmisor digital de reversa para GS7000 segmentación 1:1, EDR GS1185, Ordering: 4042873. - Marca: Cisco, P/N: 800-4042188-01","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600245","breve_descripcion":"TX.DIG.P/GS7000 SEG.2:1 #4042877","descripcion":"Transmisor digital de reversa para GS7000 segmentación 2:1, EDR GS2185, Ordering: 4042877. - Marca: Cisco, P/N: 800-4042904-01","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600255","breve_descripcion":"MODUL.RX.1GHZ HARMONIC #NRM 3111A-AS-2L","descripcion":"Módulo receptor óptico 1 Ghz para nodo escalable PWRBlazer con conector SC/APC (incluye protector metálico de pigtail). - Marca: Harmonic, P/N: NRM3111A-AS-2L","marca":"HARMONIC/ AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600265","breve_descripcion":"MODUL.D/AJUST.PH P/CISCO #A91200.11","descripcion":"Módulo de ajuste Programmer Handheld para nodo compacto. - Marca: Cisco, P/N: A91200.11","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600315","breve_descripcion":"NODO VIRTUAL H/12 MOD. EDFA #NH4000-VHP2","descripcion":"4000 Series configured housing for Optical Virtual Hub; provides facilities and powering for up to 12 modules... - Marca: Aurora, P/N: NH4000-VHP2","marca":"AURORA-PACE","tipo":"AMPLIFICADOR RF"}, {"sap":"40600338","breve_descripcion":"NODO OPT. 4X4 #NC412B1S3H1-00000000","descripcion":"NC4000 series 4 X 4 Segmentable Optical Node... - Marca: Aurora, P/N: NC412B1S3H1-00000000","marca":"AURORA-PACE","tipo":"AMPLIFICADOR RF"}, {"sap":"40600372","breve_descripcion":"NODO OPT. D/2 SAL. SG1000 S/TX RTRN.","descripcion":"Nodo óptico de 2 salidas SG1000 (módulo y carcasa), 1000-42 Mhz SC-APC, 60-90 V, sin TX retorno. - Marca: Motorola","marca":"MOTOROLA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600373","breve_descripcion":"NODO OPT. D/2 SAL. SG1000 C/TX RTRN.","descripcion":"Nodo óptico de 2 salidas SG1000 (módulo y carcasa)... con TX de retorno. - Marca: Motorola","marca":"MOTOROLA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600374","breve_descripcion":"MODUL.D/RF P/SG1000 S/TX RTRN.","descripcion":"Módulo de RF para nodo Motorola SG1000, sin TX de retorno, 5-42 Mhz retorno 54-1000 Mhz directa. - Marca: Motorola","marca":"MOTOROLA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600375","breve_descripcion":"NODO OPT.GS7000 HFC 56DBMV 1.2GHZ 4 SAL.","descripcion":"Nodo óptico GS7000 HFC de 56 dBmV@1,2 Ghz TILT 18 dB, 4 salidas de alto nivel... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600376","breve_descripcion":"NODO OPT.GS7000 1X2 1.2GHZ C/TX 42/54","descripcion":"Nodo óptico GS7000 Fiber Deep de 64 dBmV@1,2 Ghz... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600377","breve_descripcion":"RS4002 MODUL.D/SEGMCION.2X2 P/AURORA","descripcion":"Módulo de Segmentación 2 x 2 para nodo Aurora.- Marca: Aurora, Modelo: RS4002","marca":"AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600378","breve_descripcion":"RS4022 MODUL.D/SEGMCION.4X4 P/AURORA","descripcion":"Módulo de Segmentación 4 x 4 para nodo Aurora.- Marca: Aurora, Modelo: RS4022","marca":"AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600379","breve_descripcion":"MODUL.RX FW SC/APC GS7000 #GS7K1.2-STDRX","descripcion":"Módulo receptor de forward con conector SC/APC para nodo GS7000 1.2 Ghz . - Marca: Cisco,Modelo: GS7K1.2-STDRX","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600380","breve_descripcion":"MODUL.RF 1.2GHZ 42/54 #GS7K-LA-1.2G-4254","descripcion":"Módulo de RF 1.2 Ghz, TILT 18 dB con segmentación 4 x 4, split 42/54, GaN, para nodo GS7000 1.2 Ghz. - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600381","breve_descripcion":"MODUL.RF 1.2GHZ 42/54 GS7000 FIBER DEEP","descripcion":"Módulo de RF 1,2 Ghz, TILT 22 dB, con segmentación 1x2... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600382","breve_descripcion":"CCZA.GS7000 SHO C/OIB #GS7K-SHO-HSG-1.2G","descripcion":"Carcaza para nodo GS7000 Fiber Deep, 1.2 Ghz color blanca con acceso externo TP... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600383","breve_descripcion":"PLA.OIB GS7000 HFC 1,2GHZ #GS7K-1.2G-OIB","descripcion":"Placa OIB de 8 posiciones para nodo óptico GS7000 HFC 1.2 Ghz ; Modelo: GS7K-1.2G-OIB","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600384","breve_descripcion":"RS4001-00 MODUL.D/SEGMCION.1X1 P/AURORA","descripcion":"Módulo de Segmentación 1 x 1 para nodo Aurora.- Marca: Aurora, Modelo: RS4001-00","marca":"AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600385","breve_descripcion":"MODUL.1G P/NODO PWRBLAZER #NOM3121A-85","descripcion":"Módulo de RF 1 Ghz GaAsFET... - Marca: Aurora, P/N: NOM3121A-85","marca":"AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600386","breve_descripcion":"EQ.LINEAL 1.2GHZ 15DB #GM-EQL-1.2G-15","descripcion":"Ecualizador Líneal 1.2 Ghz 15 dB para nodo Cisco GS7000. - Marca: Cisco, P/N: GM-EQL-1.2G-15","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600387","breve_descripcion":"EQ.INTERT.16.5DB 1.2GHZ#GM-EQL-1.2G-16.5","descripcion":"Ecualizador Interetapa Líneal 16,5 dB 1,2 GHz para nodo GS7000. - Marca: Cisco, P/N: GM-EQL-1.2G-16.5","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600388","breve_descripcion":"EQ.INTERET. 18DB 1.2GHZ #GM-EQL-1.2G-18","descripcion":"Ecualizador Interetapa Líneal 18 dB 1,2 GHz para nodo GS7000. - Marca: Cisco, P/N: GM-EQL-1.2G-18","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600389","breve_descripcion":"EQ.INTERT.19.5DB 1.2GHZ#GM-EQL-1.2G-19.5","descripcion":"Ecualizador Interetapa Líneal 19,5 dB 1,2 Ghz para nodo GS7000. - Marca: Cisco, P/N: GM-EQL-1.2G-19.5","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600390","breve_descripcion":"DTOR.D/SÑL.JUMPER #GS7K-SD-1.2G-JMP","descripcion":"Director de señal (Jumper) para uso en nodo Cisco GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-SD-1.2G-JMP","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600391","breve_descripcion":"MODUL.D/CONFIG.RET.4X1 #GS7K-RCM-1.2G-41","descripcion":"Módulo de configuración de retorno 4 x 1 sin redundancia, para nodo GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-RCM-1.2G-41","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600392","breve_descripcion":"MODUL.D/CONFIG.FWD.1X4 #GS7K-FCM-1.2G-14","descripcion":"Módulo de configuración de Forward 1 x 4 sin redundancia para nodo GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-FCM-1.2G-14","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600393","breve_descripcion":"MODUL.D/CONFIG.FWD.2X4 #GS7K-FCM-1.2G-24","descripcion":"Módulo de configuración de forward 2 x 4, para nodo GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-FCM-1.2G-24","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600394","breve_descripcion":"MODUL.D/CONFIG.RET.4X2#GS7K-RCM-1.2G-42B","descripcion":"Módulo de configuración de retorno 4 x 2, para nodo GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-RCM-1.2G-42B","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600395","breve_descripcion":"MODUL.D/CONFIG.FWD.4X4 #GS7K-FCM-1.2G-44","descripcion":"Módulo de configuración de forward 4 x 4, para nodo GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-FCM-1.2G-44","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600396","breve_descripcion":"MODUL.D/CONFIG.RET.4X4 #GS7K-RCM-1.2G-44","descripcion":"Módulo de configuración de retorno 4 x 4, para nodo GS7000 1,2 Ghz. - Marca: Cisco, P/N: GS7-RCM-1.2G-44","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600397","breve_descripcion":"NODO GS7K HFC 1.2GHZ #GS7KS811S11XBXXXXX","descripcion":"Nodo óptico GS7000 HFC de 56 dBmV@1,2 Ghz... - Marca: Cisco, P/N: GS7KS811S11XBXXXXX","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600398","breve_descripcion":"NODO GS7K SHO 1.2GHZ #GS7KH811S13XBXXXXX","descripcion":"Nodo óptico GS7000 Fiber Deep de 64 dBmV@1,2 Ghz... - Marca: Cisco, P/N: GS7KH811S13XBXXXXX","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600399","breve_descripcion":"MODUL.RF 1.2GHZ 4X4 #GS7K-LA-1.2G-8502","descripcion":"Módulo de RF 1,2 Ghz, con segmentación 4x4, split 85/102 híbridos GaN, para nodo GS7000 HFC. - Marca: Cisco, P/N: GS7-LA-1.2G-8502","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600401","breve_descripcion":"MODUL.RF 1GHZ 4X4 P/GS7000 1GHZ HFC STD.","descripcion":"Módulo de RF 1 Ghz, con segmentación 4x4, split 85/102, para nodo GS7000 1 Ghz HFC estandar","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40600402","breve_descripcion":"HOUSING NODO ESCALAB.AURORA #NH4000-H","descripcion":"Housing de nodo escalable- Marca: Aurora, Modelo: NH4000-H","marca":"AURORA-PACE","tipo":"AMPLIFICADOR RF"}, {"sap":"40600403","breve_descripcion":"FTE.D/ALIM.P/NODO AURORA #PS4001","descripcion":"Fuente de alimentación para Nodo. - Marca: Aurora, Modelo: PS4001","marca":"AURORA-PACE","tipo":"AMPLIFICADOR RF"}, {"sap":"40600404","breve_descripcion":"MODUL.RCPTOR.OPT.P/NODO AURORA #AR4224","descripcion":"Módulo receptor óptico para nodo escalable- Marca: Aurora, Modelo: AR4224","marca":"AURORA-PACE","tipo":"AMPLIFICADOR RF"}, {"sap":"40600405","breve_descripcion":"MODUL.AMPLIF.RF P/NODO AURORA #OA4344SG","descripcion":"Módulo amplificador de RF GaN para nodo- Marca: Aurora, Modelo: OA4344SG","marca":"AURORA-PACE","tipo":"AMPLIFICADOR RF"}, {"sap":"40600406","breve_descripcion":"KIT CBL.P/NODO AURORA #WH4124","descripcion":"Kit de cables para nodo Aurora. Minicoax ( 4 reversa+2 directa) + cable poder. - Marca: Aurora, Modelo: WH4124","marca":"AURORA","tipo":"AMPLIFICADOR RF"}, {"sap":"40600407","breve_descripcion":"NODO OM6000 1.2GHZ 85/102MHZ C/1RX Y 1TX","descripcion":"Nodo OM6000 Fiber Deep, 34VDC Tilt 22 dB, hibrido GaN... - Marca: Arris","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600408","breve_descripcion":"MODUL.RX.DIRECT.1.2G #OM6-F34-1.2-RX-SCA","descripcion":"Módulo receptor de directa 1,2 Ghz SC/APC para nodo OM6000 Fiber Deep 34V. - Marca: Arris, Modelo: OM6-F34-1.2-RX-SCA","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600409","breve_descripcion":"MOD.TX.1471NM SC/APC OM6000 #1510388-047","descripcion":"Módulo transmisor de retorno analogico 1471nm SC/APC para nodo OM6000 Fiber Deep 34V.- Marca: Arris, Modelo: OM6-ANLG-TX-CWDM-1471, P/N: 1510388-047","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600410","breve_descripcion":"MODUL.CONFIG.DTA. #OM6-1.2-SEG-1X-DS-FD","descripcion":"Módulo de configuración de directa 1 x 1 para nodo OM6000 Fiber Deep 1,2 Ghz. - Marca: Arris","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600411","breve_descripcion":"MODUL.CONFIG.DTA. #OM6-1.2-SEG-2X-DS-FD","descripcion":"Módulo de configuración de directa 2 x 2 para nodo OM6000 Fiber Deep 1,2 Ghz. - Marca: Arris","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600412","breve_descripcion":"MODUL.RET. #OM6-204-SEG-SWITCH-US-HFC/FD","descripcion":"Módulo de configuración de retorno 1X , 2X y 4X para nodo OM6000 Fiber Deep 1,2 Ghz. - Marca: Arris","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600413","breve_descripcion":"MODUL.AMPLIF.1.2GHZ #OM6-1.2-85-F34-AMP","descripcion":"Módulo amplificador de RF 1.2 Ghz 85/102 Mhz 34V para nodo OM 6000 Fiber Deep. - Marca: Arris","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40600414","breve_descripcion":"MODUL.FTE.D/ALIM.60/90VCA MOD.OM6-F34-PS","descripcion":"Módulo fuente de alimentación 60/90 VCA 34VDC, para nodo OM6000 Fiber Deep. - Marca: Arris, Modelo: OM6-F34-PS","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40500119","breve_descripcion":"MOD.TRONC.BRIDG.870MHZ 32DB SC.ATL.","descripcion":"Módulo mini Troncal Bridger 870 Mhz, 32 dB, 40/52, con AGC (canal 61)... - Marca: S. Atlanta, P/N: 1112841013200000","marca":"S. ATLANTA","tipo":"AMPLIFICADOR RF"}, {"sap":"40500120","breve_descripcion":"FTE. GAINMAKER D/HGD O U.TRIPLE","descripcion":"Fuente Gainmaker de High Gain Dual o Unbalanced Triple. - Marca: S. Atlanta, P/N: 734771","marca":"S.ATLANTA/ CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500126","breve_descripcion":"MODUL.FTE.60VCA DPS2 P/FTMT-FTMB S/TRAF.","descripcion":"Módulo fuente de 60VCA modelo DPS2 para FTMT-FTMB (sin transformador). - Marca: Texscan","marca":"TEXSCAN","tipo":"AMPLIFICADOR RF"}, {"sap":"40500127","breve_descripcion":"TRAFO 60VCA (5 CBL) D/DPS2 P/FTMT-FTMB","descripcion":"Transformador de 60VCA (5 cables) de módulo fuente para FTMT-FTMB. - Marca: Texscan, Modelo: DPS2","marca":"TEXSCAN","tipo":"AMPLIFICADOR RF"}, {"sap":"40500128","breve_descripcion":"TRAFO 90VCA (7 CBL) D/DPS-90 P/FTMT-FTMB","descripcion":"Transformador de 90VCA (7 cables) de módulo fuente para FTMT-FTMB. - Marca: Texscan, Modelo: DPS-90","marca":"TEXSCAN","tipo":"AMPLIFICADOR RF"}, {"sap":"40500132","breve_descripcion":"AMP.TRONC.BRIDG. 1GHZ #1112G21013219000","descripcion":"Amplificador troncal bridger (módulo y carcasa) 1 Ghz, 34/43 dB... - Marca: Cisco, P/N: 1112G21013219000","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500133","breve_descripcion":"AMP.D/DIST. 1GHZ #1122G21013219000","descripcion":"Amplificador mini bridger (módulo y carcasa) 1 GHz, 43 dB... - Marca: Cisco, P/N: 1122G21013219000","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500134","breve_descripcion":"MOD.TRONC.BRIDG. 1GHZ #1112G21013200000","descripcion":"Módulo troncal bridger 1 Ghz, 34/43 dB... - Marca: Cisco, P/N: 1112G21013200000","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500135","breve_descripcion":"MOD.D/DIST. 1GHZ #1122G21013200000","descripcion":"Módulo mini bridger 1 Ghz, 43 dB... - Marca: Cisco, P/N: 1122G21013200000","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500139","breve_descripcion":"AMP.SAIII MODUL.Y CCZA.46DB S/AGC C/RET.","descripcion":"Amplificador SA III (módulo y carcasa) 750 Mhz, High Gain Dual, 46 dB... - Marca: S. Atlanta","marca":"S. ATLANTA","tipo":"AMPLIFICADOR RF"}, {"sap":"40500140","breve_descripcion":"AMP.D/DIST.1GHZ CISCO GaN HIGH GAIN DUAL","descripcion":"Amplificador mini bridger (módulo y carcasa) 1 GHz, 44 dB... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500141","breve_descripcion":"AMPLIF.FTMB 750MHZ 36DB C/RET.C/AGC","descripcion":"Amplificador mini bridger (módulo y carcasa) FTMB 750 Mhz, 36 dB... - Marca: Texscan","marca":"TEXSCAN","tipo":"AMPLIFICADOR RF"}, {"sap":"40500142","breve_descripcion":"MODUL.FM601E GaN 1GHZ MODUL. Y CARCZA.","descripcion":"Amplificador mini bridger FlexMax 601e (módulo y carcasa) 1 Ghz, 43 dB... - Marca: Arris","marca":"ARRIS","tipo":"AMPLIFICADOR RF"}, {"sap":"40500143","breve_descripcion":"MODUL.AMP.DISTR.1GHZ 44DB CISCO GaN HGD","descripcion":"Módulo mini bridger 1 Ghz, 44 dB... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500144","breve_descripcion":"AMP.(MODUL.Y CCZA) CISCO HGBT GaN 1GHZ","descripcion":"Amplificador mini bridger (módulo y carcasa) Cisco GainMaker GaN High Gain Balanced Triple 1 GHz... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500145","breve_descripcion":"MODUL.AMP. CISCO HGBT GaN 1GHZ","descripcion":"Módulo mini bridger Cisco GainMaker GaN High Gain Balanced Triple 1 GHz System Amplifier... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"}, {"sap":"40500146","breve_descripcion":"AMP.1GHZ GaN MOTOROLA #BT100K-4GAXH-F-R","descripcion":"Amplificador mini troncal BT 1 GHz (módulo y carcasa) GaN... - Marca: Motorola","marca":"ARRIS/MOTOROLA","tipo":"AMPLIFICADOR RF"}, {"sap":"40500147","breve_descripcion":"MODUL.AMP.MOTOROLA #BT100K-4GAXH-E15-R","descripcion":"Módulo mini troncal BT 1 GHz, GaN... - Marca: Motorola","marca":"ARRIS/MOTOROLA","tipo":"AMPLIFICADOR RF"}, {"sap":"40500148","breve_descripcion":"CCZA. P/MOTOROLA BT100 #BTA-SXHG-R","descripcion":"Carcasa mini troncal BT 1 Ghz. - Marca: Motorola, P/N: BTA-SXHG-R","marca":"ARRIS/MOTOROLA","tipo":"AMPLIFICADOR RF"}, {"sap":"40500149","breve_descripcion":"AMP.D/DIST.1,2GHZ 48DB GAN 85/102 CISCO","descripcion":"Amplificador mini bridger (módulo y carcasa) 1,2 GHz, 48 dB... - Marca: Cisco","marca":"CISCO","tipo":"AMPLIFICADOR RF"} ]

def seed():
    # crear tablas si no existen
    Base.metadata.create_all(bind=engine)
    db = SessionLocal()
    seen_saps = set()  # para evitar duplicados dentro del mismo NEW_ITEMS
    try:
        added = 0
        for item in NEW_ITEMS:
            sap = item.get("sap")
            if not sap:
                continue
            # si ya vimos este sap en esta ejecución, lo saltamos
            if sap in seen_saps:
                continue

            # verificamos si ya existe en la BD (persistida)
            exists = db.query(models.Material).filter(models.Material.sap == sap).first()
            if exists:
                # marcamos como visto para no volver a intentar en esta ejecución
                seen_saps.add(sap)
                continue

            # crear objeto
            m = models.Material(
                sap=sap,
                breve_descripcion=item.get("breve_descripcion"),
                descripcion=item.get("descripcion"),
                marca=item.get("marca"),
                tipo=item.get("tipo"),
                created_at=datetime.now(timezone.utc)
            )

            # intentamos agregar y commitear por fila para evitar que un duplicado posterior rompa todo
            try:
                db.add(m)
                db.commit()      # commit por registro
                added += 1
                seen_saps.add(sap)
            except IntegrityError:
                # si hubo violación de unicidad o similar, rollback y seguimos
                db.rollback()
                # opcional: imprimir o loggear
                print(f"Skipping duplicate or failed insert for sap={sap}")
                continue

        print(f"Seed terminado. Nuevos registros agregados: {added}")
    finally:
        db.close()

if __name__ == "__main__":
    seed()
